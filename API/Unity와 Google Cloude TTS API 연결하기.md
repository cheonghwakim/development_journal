**PART 1. API KEY 발급**

\1. 시작

\- 새 프로젝트 생성

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMTQw/MDAxNjE2NzI0NDgzNzYy.tP-IaB_Nqh1D4EhE4KrJlVvx4oHUQO-xiihGsajXR6cg.y3mo8RFuRdz78dAGJoXWaAr3mebF1bpEqF6MznRyDqQg.PNG.evanmacmillan/create.png?type=w966)



\- 프로젝트 이름 적고 만들기

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMTA2/MDAxNjE2NzM1MTIxMjUy.kO3A-x2czMYyWymmsL2wOWCJDhVjEeY6F-dgIczKlRYg.10-MC9M1wyfReOynimJLJC22rB83LXNyVgEK9NmGteYg.PNG.evanmacmillan/name.PNG?type=w966)



\- API 및 서비스 사용 설정 클릭

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMjk4/MDAxNjE2NzM1MjAwMDEz.8PiyqFCz2exl02s6yosEhTY0Pk-w_SFW048KHNB1qLcg.atZrCF73IaUiiRW5jq2qEFN4eHGiM5RdA4iY7I7vB80g.PNG.evanmacmillan/api_edit.png?type=w966)



\- Cloud Text-to-Speech API 검색

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMTk3/MDAxNjE2NzM1Mjk5MjYx.ri8cUuVFqtfLJSuLWPpp0CcQx2gafYnyqaIoinALrsAg.JVlEyGHy3UCM30X4agnucxl3dmlaobhMuLAJ-WwqlZUg.PNG.evanmacmillan/API_SEARCH.PNG?type=w966)



\- 사용 클릭

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfOTkg/MDAxNjE2NzM1MzU3NTUz.LJpoUx0MBOWelHcIEVU6li_rNviYxCRc0LCC77C_WEQg.U0wBsmLryLUjQ7pXVe-gzD8h7p1N3VBkhMYFWXsmtikg.PNG.evanmacmillan/USE_CLICK.PNG?type=w966)



\- 사용자 인증정보 만들기 클릭

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMTI3/MDAxNjE2NzM1NDQzNjg2.-5OldMkfOaxaQz_kwb_eGBQaZCItrZx8WoaJbpSTTNkg.BPlWWTExzLQcTOBsz4s7jtcYrq3gp7sCXdqbN5IRekgg.PNG.evanmacmillan/pasted_image_0.png?type=w966)



\- 서비스 계정 클릭

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfNzAg/MDAxNjE2NzM1NDYyMTEz.sVHu5em0x9v9QW7gF1jMqlftMS4sJOaDjEIWIeH9Frcg.tyv0e3HptReu_Ee7qOGUVJtROcPt60500k1T4_WANkEg.PNG.evanmacmillan/pasted_image_0_(1).png?type=w966)



\- 서비스 계정 만들기 클릭

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMTI0/MDAxNjE2NzM1NjExNzY4.RdbFqHIWvgSvL_nPAlQA1NaPnWtNShS-hIO7tqtp5g0g.0unqzvGWXD6h0TbqniX3iK75yn8ob3f_Xx4EimdtIJcg.PNG.evanmacmillan/CREATE_ACCOUNT.png?type=w966)

\- 서비스 계정 이름 적고 만들기

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMzkg/MDAxNjE2NzM1NjkwMTAz.61e7IGuyTGWdovLmbw8MJpvO7SIp62UeLLBg_eieygsg.ojumKvFb2t3vUYHVjN55TD_bg5BHIo9F8vKD_wjm9DUg.PNG.evanmacmillan/CREATE_SERVICE.PNG?type=w966)



\- 설치 가이드 대로 역할은 선택하지 않는다. '계속' 클릭

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMTIg/MDAxNjE2NzM1ODg5NjE0.fvtPMadLThE3vSBVaIEYbTGoKKXEYdVVMVfQjP_u7Nkg.hYpMHUcsUgpwpV7jQ5Dm7FLdOFecxyq2M5sj9Lxv6rcg.PNG.evanmacmillan/NONE.png?type=w966)

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMjkw/MDAxNjE2NzM1OTczMTQw.F6C96EajNQP0L4jzf78UvlSkcHwTuBTvl2bhQAF-Hzcg.9ZAKBFtevvCmzf34j4RMpHy_hpIh_uzp3o7wzKWaTgEg.PNG.evanmacmillan/STEP2.PNG?type=w966)



\- 키 생성을 위해 키 관리 -> 새 키 만들기

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMTQ2/MDAxNjE2NzM2MTAwODUx.qmhYXiXy9p65BvCrrD7vSajfBAqK2lL7neW8EvY0dtYg.yTN10OzogOj4b2FRaLbbUrnnh3BiP497WlancL6QcJcg.PNG.evanmacmillan/KEYS.png?type=w966)

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfNzAg/MDAxNjE2NzM2MTUxNjM5.RJGnEwjNgBCyxJU0UbpcB1aqwAuuC0-QD4A4ypnP9Mkg.n6fZMVwsKiBA9j73kI7-PxegyId9kxOWzQwMonembtwg.PNG.evanmacmillan/NEW_KEY.png?type=w966)



\- JSON 선택 후 만들기

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMjg0/MDAxNjE2NzM2MjAwMjc5.baFAwNgkM2KUR3Pwj4_o--4N2HmbUD6OnRb0o1YQFrAg.tv2-Yb3B3Y8V2XfgP03sXlTA9PBbiBOnNTCMgMU-tjMg.PNG.evanmacmillan/JSON.PNG?type=w966)



\- 적당한 곳에 JSON파일을 넣고, 해당 경로를 환경변수에 **GOOGLE_APPLICATION_CREDENTIALS** 라는 이름으로 추가.

(가이드 대로라면 CMD에서 **set** **GOOGLE_APPLICATION_CREDENTIALS=[PATH]** 하는건데, 현재 셀 세션에만 적용되므로 새 세션을 열 경우 변수를 다시 설정해야 한다.) 나는 CMD에서 하지 않고 환경변수에 추가했다. 

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMjYw/MDAxNjE2NzM2MzUwMDQ3.8XoG9FioqTKlVl3ZciDBOOL_3SUibq7fEQ2MeYaa_-cg.xnsyxLOOE--SMKR1OwqSpuzGRZsTh5ng_4dYLMujWSEg.PNG.evanmacmillan/PATH1.PNG?type=w966)

(나같은 경우는 C:\SSAFY\Google-Cloud\TTS\TTS Project-006f523f70ca.json)

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMjg4/MDAxNjE2NzM2NDU1NzQz.B1Ii82Bkp5vqe9ryyHdsQNJgVjKzZoFpZKTH62dlfMwg.xbfgGzZgShXZXV5x70Zytkla0RVmJmHivZjEOhQPZE8g.PNG.evanmacmillan/PATH2.PNG?type=w966)



\2. Cloud SDK 설치

이 부분은 아래 링크를 그대로 따라하는걸 추천한다.

https://cloud.google.com/sdk/docs/install?hl=ko



어떤 글에선 Cloud SDK 설치 프로그램을 다운받는게 아니라 ZIP파일을 다운받아서 압축 해제한다음 사용하는 방법이 있었는데, 이 방법은 나에게 맞지 않았고 그냥 .EXE 실행이 잘 먹혔다.

설치는 그냥 따로 체크하거나 체크해제할건 없었고 그냥 Next->를 눌렀다.

설치가 끝나면 Google Cloud SDK 셸이 시작 -> gcloud init 입력 -> Y입력 -> 구글액세스 허용 선택 -> 프로젝트 번호 선택(나는 1번) 까지 한다.

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMjk0/MDAxNjE2NzU4Nzg3Njcy.lRekmcUFEYtEwdCHYz4RUZNDQOqZpr9P0wQ6uvj9bQog.2VjMpjTAFcAZldTQla2nUtqqjmWOkENI6FFZvq1Fh5sg.PNG.evanmacmillan/cmd.PNG?type=w966)

 

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMjcz/MDAxNjE2NzU4OTQxMTIw.jFf5d4CHgqPqwJT86ulERbrCzpPy4LMhwrJwQtW3Wn8g.U4lbVVIbSdy9B7-WlVyjnaVi9AWWsVpbwiOq0J-nuhkg.PNG.evanmacmillan/pasted_image_0_(2).png?type=w966)

\3. API KEY 생성

\- 다시 구글 클라우드 플랫폼으로 돌아가 아래 창에서 API키 발급을 선택한다.

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMjk3/MDAxNjE2NzU5MDk2NDE4.qdbUkL6XxSRc0fMS80QrzPNlukIr7yggRjDT6UyOj4Qg.m_JJgBYKwYR-A6mm-dD73xiXn8lavQz9-TKjVe334Ywg.PNG.evanmacmillan/tempsnip.png?type=w966)



\- 발급된 키를 프로젝트에 사용한다!

![img](https://postfiles.pstatic.net/MjAyMTAzMjZfMjc4/MDAxNjE2NzU5MjU1OTgw.3iAWuq_FZbSCGZiUJAK6aDdEQ75297dtKfR8CWzYBc4g.eUZtJiYdhiRCMn14048SOr0owhy0vJh2KAF_hmiHhKUg.PNG.evanmacmillan/COMPLE.PNG?type=w966)





**<참고한 것>**설치 가이드https://cloud.google.com/text-to-speech/docs/quickstart-protocol?hl=ko설치에 참고한 블로그https://webnautes.tistory.com/1247



**PART 2. Unity에 TTS 구현**



코드

https://kumgo1d.tistory.com/28

```
using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
//이 둘을 선언해야 JsonUtility, HttpWebRequest, StreamReader 등을 사용할 수 있다.
using System.IO;
using System.Net;
//어쩌다 추가했는지 기억이 안남..
using System.Text;

public class TTSScript : MonoBehaviour
{
    private string apiURL = "https://texttospeech.googleapis.com/v1beta1/text:synthesize?key=키 입력";
    SetTextToSpeech tts = new SetTextToSpeech();

    // Start is called before the first frame update
    private void Start()
    {
        Init();
        CreateAudio();   
    }

    void Init(){
        SetInput si = new SetInput();
        si.text = "안녕하세요";
        tts.input = si;

        SetVoice sv = new SetVoice();
        sv.languageCode = "ko-KR";
        sv.name = "ko-KR-Wavenet-A";
        sv.ssmlGender = "FEMALE";
        tts.voice = sv;

        SetAudioConfig sa = new SetAudioConfig();
        sa.audioEncoding = "LINEAR16";
        sa.speakingRate = 0.8f;
        sa.pitch = 0;
        sa.volumeGainDb = 0;
        tts.audioConfig = sa;
    }
    // Update is called once per frame
    void Update()
    {
        
    }

    //string값을 byte array -> float array로 변환
    private void CreateAudio(){
        //HttpWebRequest요청후 반환된 string값을 저장
        var str = TextToSpeechPost(tts);

        //string값을 JsonUtility를 사용하여 JSON데이터 형식으로 다시 저장
        GetContent info = JsonUtility.FromJson<GetContent>(str);

        //JSON 형식으로 저장된 값을 byte array로 변환
        var bytes = Convert.FromBase64String(info.audioContent);

        //byte array를 float array로 변환
        var f = ConvertByteToFloat(bytes);

        //create audio clip
        AudioClip audioClip = AudioClip.Create("audioContent",f.Length,1,44100,false);
        audioClip.SetData(f,0);

        AudioSource audioSource = FindObjectOfType<AudioSource>();

        audioSource.PlayOneShot(audioClip, 0.7F);//0.7F제발 추가해;
    }

    private static float[] ConvertByteToFloat(byte[] array){
        float[] floatArr = new float[array.Length/2];

        for(int i=0;i<floatArr.Length;i++){
            floatArr[i]=BitConverter.ToInt16(array,i*2)/32768.0f;
        }
        return floatArr;
    }

    //POST방식으로 웹과 소통하기 위한 메소드
    public string TextToSpeechPost(object data){
        //JsonUtility 사용.. string을 요청 보내기 위한 byte[]로 변환
        string str = JsonUtility.ToJson(data);
        var bytes = System.Text.Encoding.UTF8.GetBytes(str);

        //요청을 보낼 주소와 세팅
        
        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(apiURL);
       
        request.Method = "POST";
        request.ContentType = "application/json";
        request.ContentLength = bytes.Length;

        //Stream 형식으로 데이터를 보냄 request
        try{
            using(var stream = request.GetRequestStream()){
                stream.Write(bytes,0,bytes.Length);
                stream.Flush();
                stream.Close();
            }
           
            
            //여기서부터 안됨
            //요청 데이터에 대한 응답 데이터를 StreamReader로 받음
            HttpWebResponse response = (HttpWebResponse)request.GetResponse();
            //StreamReader로 stream데이터를 읽음
            StreamReader reader = new StreamReader(response.GetResponseStream());
            //stream데이터를 string으로 변환
            string json = reader.ReadToEnd();
            return json;
        }
        catch(WebException e){
            //log
            return null;
        }
    }
}



[System.Serializable]
public class SetTextToSpeech{
    public SetInput input;
    public SetVoice voice;
    public SetAudioConfig audioConfig;
}
[System.Serializable]
public class SetInput{
    public string text;
    //public string ssml;
}
[System.Serializable]
public class SetVoice{
    public string languageCode;
    public string name;
    public string ssmlGender;
}
[System.Serializable]
public class SetAudioConfig{
    public string audioEncoding;
    public float speakingRate;
    public int pitch;
    public int volumeGainDb;
    //public int sampleRateHertz;
}
[System.Serializable]
public class GetContent{
    public string audioContent;
}
```



오브젝트에(나같은 경우는 정육면체 Cube) add Component로 Audio Source 추가한다.

![img](https://postfiles.pstatic.net/MjAyMTAzMjVfODQg/MDAxNjE2NjU5MTkyNDMy.8V3H9Aso0BuiIdY-sRWTS_bOLUURkNiOFJzKeVWY52Qg._7poL08IV3--BcDyzh0yQq72w_fkzmfsZtKeYrqgwZgg.PNG.evanmacmillan/as.PNG?type=w966)

그리고 MainCamera엔 AudioListener를 추가

![img](https://postfiles.pstatic.net/MjAyMTAzMjVfNzMg/MDAxNjE2NjU5MjM5OTIx.Ay2OvML8uWflVMSnc4rWuraQhpgjeHdjqJ0YpM3gFb4g.M7PXYpp90Yvy2uamENM7aTUtRtB6gTvfswXYwJzGwrcg.PNG.evanmacmillan/list.PNG?type=w966)



여기까지 하니 FindObjectOfType 가 더이상 null을 반환하지는 않고 오류도 없는데 소리가 안나와서

AudioSource.PlayOneShot 문서를 참고하니 볼륨 조절 변수가 있길래 넣어보니 잘 나온다!! 

audioSource.PlayOneShot(audioClip, 0.7F);//0.7F제발 추가해







유니티 문서를 잘 참고하자

https://docs.unity3d.com/ScriptReference/AudioSource.PlayOneShot.html





+목소리 종류

https://cloud.google.com/text-to-speech/docs/voices?hl=ko

ko-KR-Wavenet-A가 제일 나음